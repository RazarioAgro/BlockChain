из  hashlib  импортировать  sha256
импортировать  json
импорт  ОС

block_dir  =  ОС . курдир  +  '/блок/'

деф  get_hash ( имя_файла ):
  файл  =  открыть ( каталог_блока  +  имя_файла , 'rb' ). читать ()
  вернуть  sha256 ( файл ). шестнадцатеричный дайджест ()

 защита get_files ( ):
  файлы  =  ОС . каталог_списка ( каталог_блока )
  вернуть  отсортированный ([ int ( i ) для  i  в  файлах ])

деф  check_integrity ():
  # 1. Считать хеш глобального блока
  # 2. Вычислить хеш глобального блока
  # 3. Сравнить полученные данные
  файлы  =  получить_файлы ()
  р  = []

  для  файла  в  файлах [ 1 :]:
      f  =  открыть ( block_dir  +  str ( файл ))
      ч  =  json . загрузить ( f )[ 'хэш' ]
      
      предыдущий_файл  =  строка ( файл  -  1 )
      фактический_хэш  =  получить_хэш ( предыдущий_файл )

      если  ч  ==  фактический_хэш :
        рез  =  'ОК'
      еще :
        рез  =  'Нет'
      # print(f'Блок {prev_file}: {res}')
      р . добавить ({ 'блок' : предыдущий_файл , 'результат' : res })
  вернуть  г

def  write_block ( имя , количество , кому , prev_hash = '' ):
  файлы_int  =  получить_файлы ()
  список_файлов  =  целое_файлов [ - 1 ]
  имя_файла  =  строка ( список_файлов + 1 )  
  prev_hash  =  get_hash ( str ( список_файлов ))
  
  
  # печать (имя_файла)

  данные  = {
          "имя" : имя ,
          "сумма" : сумма ,   
          "кому_кому" : кому_кому ,
          "хеш" : предыд_хеш }
  с  открытым ( block_dir  +  files_name , 'w' ) в качестве  файла :
    json . дамп ( данные , файл , отступ = 4 , sure_ascii = False )

деф  основной ():
  # write_block(name='Миша', amount=5, to_whom='Даша')
  печать ( проверка целостности ())

если  __name__  ==  '__main__' :
  основной ()
